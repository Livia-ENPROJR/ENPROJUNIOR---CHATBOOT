<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Chatbot Enprojunior</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: url('https://raw.githubusercontent.com/Livia-ENPROJR/ENPROJUNIOR---CHATBOOT/main/FUNDO.png');
      background-size: cover;
      background-attachment: fixed;
      background-position: center;
      background-repeat: no-repeat;
      color: #eaeaea;
      padding: 20px;
    }
    #chatbox {
      width: 100%;
      max-width: 500px;
      height: 500px;
      border: 2px solid #0f3460;
      background: rgba(22, 33, 62, 0.85);
      padding: 10px;
      overflow-y: auto;
      margin: 0 auto 20px auto;
      border-radius: 8px;
    }
    #userinput {
      width: 100%;
      max-width: 500px;
      margin: 0 auto;
      display: flex;
    }
    #input {
      flex: 1;
      padding: 10px;
      border: 2px solid #0f3460;
      border-radius: 5px 0 0 5px;
      font-size: 16px;
    }
    #sendbtn {
      padding: 10px 20px;
      border: 2px solid #0f3460;
      background: #0f3460;
      color: white;
      cursor: pointer;
      border-radius: 0 5px 5px 0;
    }
    .message {
      margin: 10px 0;
    }
    .user {
      color: #00adb5;
    }
    .bot {
      color: #f7d794;
    }
    a {
      color: #4dd0e1;
      word-break: break-all;
    }
  </style>
</head>
<body>

  <div id="chatbox"></div>

  <div id="userinput">
    <input type="text" id="input" placeholder="Digite sua dÃºvida..." autocomplete="off" />
    <button id="sendbtn">Enviar</button>
  </div>

  <script>
    const chatbox = document.getElementById('chatbox');
    const input = document.getElementById('input');
    const sendbtn = document.getElementById('sendbtn');

    // FormulÃ¡rios fixos jÃ¡ definidos
    const formulariosFixos = [
      {
        nome: "Termo de voluntariado",
        link: "https://www.autentique.com.br/",
        descricao: "ğŸ“„ O termo serÃ¡ enviado para seu e-mail via Autentique. Acesse sua conta pelo site."
      },
      {
        nome: "PresenÃ§a nas RGs",
        link: "https://forms.gle/s1KYUs62sUXyvSY88",
        descricao: "ğŸ“… Link de presenÃ§a nas RGs"
      },
      {
        nome: "Justificativa de ausÃªncia",
        link: "https://forms.gle/LyPhkf5XfaFnhH3D9",
        descricao: "ğŸ“ Justificativa de ausÃªncia"
      },
      {
        nome: "SolicitaÃ§Ã£o de desligamento",
        link: null,
        descricao: "ğŸš¨ Para solicitar o termo de desligamento, envie uma mensagem para a atual diretora de GestÃ£o de Pessoas."
      },
      {
        nome: "FormulÃ¡rio de nÃ£o conformidades",
        link: "https://forms.gle/GFtWEwDWqGQhytcF9",
        descricao: "ğŸ“‹ FormulÃ¡rio de nÃ£o conformidades"
      },
      {
        nome: "E-book nÃ£o conformidades",
        link: "https://drive.google.com/file/d/14oAmosD0bzDpwmIo0jfMsQ6i_02c5Y_r/view?usp=drive_link",
        descricao: "ğŸ“˜ E-book"
      },
      {
        nome: "FormulÃ¡rio de conversas difÃ­ceis",
        link: "https://docs.google.com/forms/d/e/1FAIpQLSdCFOsEcJzsIb5BOqX6KAJ-PNXUbg1iSggRTHU95ib_77bFMg/viewform",
        descricao: "ğŸ’¬ FormulÃ¡rio de conversas difÃ­ceis"
      },
      {
        nome: "FormulÃ¡rio de marketing/cartas de serviÃ§os",
        link: "https://forms.gle/PjDSWbB3wxG6WX87A",
        descricao: "ğŸ“£ FormulÃ¡rio de marketing/cartas de serviÃ§os"
      },
      {
        nome: "Link para automatizaÃ§Ã£o das atas",
        link: "https://docs.google.com/forms/d/e/1FAIpQLSej4zA2wQ1eBEicu2q8rP__kUC8UDCfoZ2KahxqmLmSDQ987Q/viewform",
        descricao: "ğŸ—‚ï¸ Link para automatizaÃ§Ã£o das atas"
      },
    ];

    // FunÃ§Ã£o para carregar formulÃ¡rios temporÃ¡rios do localStorage
    function carregarFormulariosTemporarios() {
      const dados = localStorage.getItem('formulariosTemporarios');
      if (!dados) return [];
      try {
        const lista = JSON.parse(dados);
        // Filtrar sÃ³ os que ainda nÃ£o expiraram
        const hoje = new Date();
        return lista.filter(f => new Date(f.validade) >= hoje);
      } catch {
        return [];
      }
    }

    // Salvar lista atualizada no localStorage
    function salvarFormulariosTemporarios(lista) {
      localStorage.setItem('formulariosTemporarios', JSON.stringify(lista));
    }

    // FunÃ§Ã£o para apagar formulÃ¡rios expirados - usada no carregamento
    function limparFormulariosExpirados() {
      const lista = carregarFormulariosTemporarios();
      salvarFormulariosTemporarios(lista); // salva sÃ³ os vÃ¡lidos
    }

    // Estado da conversa para cadastro de formulÃ¡rio temporÃ¡rio
    let estadoCadastro = null; 
    // objeto temporÃ¡rio para armazenar dados do novo formulÃ¡rio
    let novoFormularioTemp = {};

    // FunÃ§Ã£o para listar formulÃ¡rios vÃ¡lidos (fixos + temporÃ¡rios)
    function listarFormulariosValidos() {
      const temporarios = carregarFormulariosTemporarios();
      const todos = [...formulariosFixos];
      // Adicionar temporÃ¡rios na lista final (com link e validade)
      temporarios.forEach(f => {
        todos.push({
          nome: f.nome,
          link: f.link,
          descricao: f.descricao + ` (DisponÃ­vel atÃ© ${f.validade})`
        });
      });
      return todos;
    }

    // FunÃ§Ã£o principal para responder mensagens
    function responder(texto) {
      texto = texto.toLowerCase().trim();

      // Se estamos no fluxo de cadastro de formulÃ¡rio
      if (estadoCadastro) {
        if (estadoCadastro === 'nome') {
          if (texto.length < 3) {
            return 'ğŸ¤– Nome muito curto, por favor digite um nome vÃ¡lido para o formulÃ¡rio.';
          }
          novoFormularioTemp.nome = texto;
          estadoCadastro = 'link';
          return 'ğŸ¤– Agora digite o *link* do formulÃ¡rio (comeÃ§ando com http:// ou https://):';
        }
        if (estadoCadastro === 'link') {
          if (!texto.startsWith('http://') && !texto.startsWith('https://')) {
            return 'ğŸ¤– Link invÃ¡lido. Por favor, digite um link que comece com http:// ou https://';
          }
          novoFormularioTemp.link = texto;
          estadoCadastro = 'validade';
          return 'ğŸ¤– Por fim, digite a *data de validade* do formulÃ¡rio no formato AAAA-MM-DD (ex: 2025-07-31):';
        }
        if (estadoCadastro === 'validade') {
          const data = new Date(texto);
          const hoje = new Date();
          if (isNaN(data.getTime())) {
            return 'ğŸ¤– Data invÃ¡lida. Por favor, digite no formato AAAA-MM-DD.';
          }
          if (data < hoje) {
            return 'ğŸ¤– Essa data jÃ¡ passou. Por favor, insira uma data futura.';
          }
          novoFormularioTemp.validade = texto;
          // DescriÃ§Ã£o opcional: usar nome e link pra criar
          novoFormularioTemp.descricao = `FormulÃ¡rio temporÃ¡rio: ${novoFormularioTemp.nome}`;
          // Salvar no localStorage
          const lista = carregarFormulariosTemporarios();
          lista.push(novoFormularioTemp);
          salvarFormulariosTemporarios(lista);
          estadoCadastro = null;
          novoFormularioTemp = {};
          return 'âœ… FormulÃ¡rio adicionado com sucesso e estarÃ¡ disponÃ­vel atÃ© a data informada!';
        }
      }

      // Comando especial para iniciar cadastro
      if (texto === 'adicionar formulÃ¡rio' || texto === 'adicionar formulario') {
        estadoCadastro = 'nome';
        novoFormularioTemp = {};
        return 'ğŸ¤– Vamos cadastrar um novo formulÃ¡rio temporÃ¡rio! Por favor, digite o *nome* do formulÃ¡rio:';
      }

      // Consultas sobre formulÃ¡rios temporÃ¡rios
      if (texto.includes('formulÃ¡rio') || texto.includes('formulario') || texto.includes('form')) {
        const formularios = listarFormulariosValidos();
        if (formularios.length === 0) return 'ğŸ¤– Nenhum formulÃ¡rio disponÃ­vel no momento.';
        let resposta = 'ğŸ“‹ *FormulÃ¡rios disponÃ­veis:*\n';
        formularios.forEach((f, i) => {
          if (f.link) {
            resposta += `${i+1}. <strong>${f.nome}</strong>: <a href="${f.link}" target="_blank">${f.link}</a> - ${f.descricao}\n`;
          } else {
            resposta += `${i+1}. <strong>${f.nome}</strong>: ${f.descricao}\n`;
          }
        });
        return resposta;
      }

      // Outras respostas fixas (como antes)
      const respostas = [
        {
          pergunta: /voluntariado/i,
          resposta: 'ğŸ“„ O termo serÃ¡ enviado para seu e-mail via Autentique. Acesse sua conta pelo site: https://www.autentique.com.br/'
        },
        {
          pergunta: /presenÃ§a|rg/i,
          resposta: 'ğŸ“… Link de presenÃ§a nas RGs: https://forms.gle/s1KYUs62sUXyvSY88'
        },
        {
          pergunta: /justificativa/i,
          resposta: 'ğŸ“ Justificativa de ausÃªncia: https://forms.gle/LyPhkf5XfaFnhH3D9'
        },
        {
          pergunta: /desligamento/i,
          resposta: 'ğŸš¨ Para solicitar o termo de desligamento, envie uma mensagem para a atual diretora de GestÃ£o de Pessoas.'
        },
        {
          pergunta: /nÃ£o conformidade|nao conformidade/i,
          resposta: 'ğŸ“‹ FormulÃ¡rio de nÃ£o conformidades: https://forms.gle/GFtWEwDWqGQhytcF9 ğŸ“˜ E-book: https://drive.google.com/file/d/14oAmosD0bzDpwmIo0jfMsQ6i_02c5Y_r/view?usp=drive_link'
        },
        {
          pergunta: /conversas difÃ­ceis|conversa/i,
          resposta: 'ğŸ’¬ FormulÃ¡rio de conversas difÃ­ceis: https://docs.google.com/forms/d/e/1FAIpQLSdCFOsEcJzsIb5BOqX6KAJ-PNXUbg1iSggRTHU95ib_77bFMg/viewform'
        },
        {
          pergunta: /gamificaÃ§Ã£o|gamificacao|pontos|ranking/i,
          resposta: `ğŸ† *GamificaÃ§Ã£o Enpro Jr*

Na Enpro Jr, a gente acredita que dedicaÃ§Ã£o, engajamento e aprendizado merecem ser reconhecidos â€” e Ã© aÃ­ que entra a nossa GamificaÃ§Ã£o! ğŸ®âœ¨

ğŸ¯ *O que gera pontos:*
- Participar de reuniÃµes de Ã¡rea e gerais
- Fazer cursos e capacitaÃ§Ãµes
- Preencher formulÃ¡rios de feedback ou pesquisa
- Entregar atividades no prazo
- Se envolver em eventos da EJ ou do MEJ
- Demonstrar proatividade e colaboraÃ§Ã£o no dia a dia

ğŸ“ˆ *Ranking e Reconhecimento:*
- Reconhecimento em reuniÃµes
- MenÃ§Ãµes em comunicaÃ§Ãµes internas
- Brindes e premiaÃ§Ãµes (quando rolarem ğŸ‘€)
- MUITO orgulho de fazer parte do time!`
        },
        {
          pergunta: /pdi|avd/i,
          resposta: `ğŸ“š *PDI e AVD*

ğŸ“Œ *PDI* (Plano de Desenvolvimento Individual): ajuda a captar a intenÃ§Ã£o do membro e os pontos que ele deseja desenvolver na EJ.
ğŸ“Œ *AVD* (AvaliaÃ§Ã£o de Desempenho): Ã© uma avaliaÃ§Ã£o 360Â°, onde membros avaliam colegas e tambÃ©m diretores.`
        },
        {
          pergunta: /hino/i,
          resposta: `ğŸ¶ *Hino da Enpro Jr.*
O hino foi inspirado em uma torcida do Sport Club e adaptado para a Enpro, reforÃ§ando nossa cultura!

â–¶ï¸ OuÃ§a aqui: https://drive.google.com/file/d/1A5fIHPcvX1cPGZ-Op1NgSMHJ9m-u1e4K/view?usp=drive_link

ğŸ¤ Letra:
Dizem por aÃ­ que a Enpro vai voar
Nesse palco vai subir, no evento vai pocar
A melhor do ES o MEJ consagrou
Quero ver tu encarar o jacarÃ© que Ã© o terror

OOOBA ÃŠÃŠÃŠÃŠ, lalaialaia
Vem pra ENPRO, vem voar
Lalaialaia
Nossa meta vai dobrar

Somos? Enpro
Bora? Voar
Bora? Voar!!!`
        },
        {
          pergunta: /estatuto/i,
          resposta: 'ğŸ“˜ Estatuto da EJ: https://drive.google.com/file/d/1tqxnb32rJ8bda_XD4P1URJeG8kzPQBj5/view?usp=drive_link'
        },
        {
          pergunta: /marketing|cartas de serviÃ§os/i,
          resposta: 'ğŸ“£ FormulÃ¡rio de marketing/cartas de serviÃ§os: https://forms.gle/PjDSWbB3wxG6WX87A'
        },
        {
          pergunta: /atas|automatizaÃ§Ã£o/i,
          resposta: 'ğŸ—‚ï¸ Link para automatizaÃ§Ã£o das atas: https://docs.google.com/forms/d/e/1FAIpQLSej4zA2wQ1eBEicu2q8rP__kUC8UDCfoZ2KahxqmLmSDQ987Q/viewform'
        },
        {
          pergunta: /formulÃ¡rio em aberto|outro/i,
          resposta: 'ğŸ“¨ Caso haja outro formulÃ¡rio ativo no momento, ele serÃ¡ divulgado aqui. Se tiver dÃºvidas especÃ­ficas, fale com a equipe de GestÃ£o de Pessoas!'
        }
      ];

      for (const item of respostas) {
        if (item.pergunta.test(texto)) {
          return item.resposta;
        }
      }

      // SugestÃ£o de palavras parecidas
      const palavrasChave = [
        'voluntariado', 'presenÃ§a', 'justificativa', 'desligamento',
        'nÃ£o conformidade', 'conversas difÃ­ceis', 'gamificaÃ§Ã£o', 'pdi',
        'avd', 'hino', 'estatuto', 'marketing', 'atas', 'formulÃ¡rio'
      ];

      for (const palavra of palavrasChave) {
        const similar = palavra.normalize("NFD").replace(/[\u0300-\u036f]/g, '');
        const entrada = texto.normalize("NFD").replace(/[\u0300-\u036f]/g, '');

        if (entrada.includes(similar.slice(0, 4))) {
          return `ğŸ¤– VocÃª quis dizer *${palavra}*? Tente digitar novamente com mais detalhes!`;
        }
      }

      return 'â“ Desculpe, nÃ£o entendi. Tente reformular sua pergunta ou fale com a equipe de GP.';
    }

    // FunÃ§Ã£o para adicionar mensagem na tela
    function appendMessage(text, sender) {
      const div = document.createElement('div');
      div.classList.add('message', sender);
      div.innerHTML = text
        .replace(/\n/g, '<br>')
        .replace(/\*([^*]+)\*/g, '<strong>$1</strong>')
        .replace(/(https?:\/\/[^\s]+)/g, '<a href="$1" target="_blank">$1</a>');

      chatbox.appendChild(div);
      chatbox.scrollTop = chatbox.scrollHeight;
    }

    // Limpar expirados ao carregar
    limparFormulariosExpirados();

    sendbtn.addEventListener('click', () => {
      const texto = input.value.trim();
      if (!texto) return;
      appendMessage('VocÃª: ' + texto, 'user');
      const resposta = responder(texto);
      setTimeout(() => {
        appendMessage('JosÃ©: ' + resposta, 'bot');
      }, 500);
      input.value = '';
      input.focus();
    });

    input.addEventListener('keypress', e => {
      if (e.key === 'Enter') sendbtn.click();
    });

    appendMessage('JosÃ©: VocÃª deve estar surpreso em me ver aqui, nÃ©? ğŸ‘€ Mas nÃ£o sou sÃ³ um mascote bonitÃ£o... tambÃ©m trabalho! ğŸ’¼ Me pergunte algo sobre formulÃ¡rios, gamificaÃ§Ã£o, PDI, nÃ£o conformidades, estatuto... TÃ´ aqui pra te ajudar! ğŸŠâœ¨', 'bot');
  </script>

</body>
</html>
