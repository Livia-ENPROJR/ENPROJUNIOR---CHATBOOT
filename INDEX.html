<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Chatbot Enprojunior</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: url('https://raw.githubusercontent.com/Livia-ENPROJR/ENPROJUNIOR---CHATBOOT/main/FUNDO.png');
      background-size: cover;
      background-attachment: fixed;
      background-position: center;
      background-repeat: no-repeat;
      color: #eaeaea;
      padding: 20px;
    }
    #chatbox {
      width: 100%;
      max-width: 500px;
      height: 500px;
      border: 2px solid #0f3460;
      background: rgba(22, 33, 62, 0.85);
      padding: 10px;
      overflow-y: auto;
      margin: 0 auto 20px auto;
      border-radius: 8px;
    }
    #userinput {
      width: 100%;
      max-width: 500px;
      margin: 0 auto;
      display: flex;
    }
    #input {
      flex: 1;
      padding: 10px;
      border: 2px solid #0f3460;
      border-radius: 5px 0 0 5px;
      font-size: 16px;
    }
    #sendbtn {
      padding: 10px 20px;
      border: 2px solid #0f3460;
      background: #0f3460;
      color: white;
      cursor: pointer;
      border-radius: 0 5px 5px 0;
    }
    .message {
      margin: 10px 0;
    }
    .user {
      color: #00adb5;
    }
    .bot {
      color: #f7d794;
    }
    a {
      color: #4dd0e1;
      word-break: break-all;
    }
  </style>
</head>
<body>

  <div id="chatbox"></div>

  <div id="userinput">
    <input type="text" id="input" placeholder="Digite sua d√∫vida..." autocomplete="off" />
    <button id="sendbtn">Enviar</button>
  </div>

  <script>
    const chatbox = document.getElementById('chatbox');
    const input = document.getElementById('input');
    const sendbtn = document.getElementById('sendbtn');

    // Formul√°rios fixos j√° definidos
    const formulariosFixos = [
      {
        nome: "Termo de voluntariado",
        link: "https://www.autentique.com.br/",
        descricao: "üìÑ O termo ser√° enviado para seu e-mail via Autentique. Acesse sua conta pelo site."
      },
      {
        nome: "Presen√ßa nas RGs",
        link: "https://forms.gle/s1KYUs62sUXyvSY88",
        descricao: "üìÖ Link de presen√ßa nas RGs"
      },
      {
        nome: "Justificativa de aus√™ncia",
        link: "https://forms.gle/LyPhkf5XfaFnhH3D9",
        descricao: "üìù Justificativa de aus√™ncia"
      },
      {
        nome: "Solicita√ß√£o de desligamento",
        link: null,
        descricao: "üö® Para solicitar o termo de desligamento, envie uma mensagem para a atual diretora de Gest√£o de Pessoas."
      },
      {
        nome: "Formul√°rio de n√£o conformidades",
        link: "https://forms.gle/GFtWEwDWqGQhytcF9",
        descricao: "üìã Formul√°rio de n√£o conformidades"
      },
      {
        nome: "E-book n√£o conformidades",
        link: "https://drive.google.com/file/d/14oAmosD0bzDpwmIo0jfMsQ6i_02c5Y_r/view?usp=drive_link",
        descricao: "üìò E-book"
      },
      {
        nome: "Formul√°rio de conversas dif√≠ceis",
        link: "https://docs.google.com/forms/d/e/1FAIpQLSdCFOsEcJzsIb5BOqX6KAJ-PNXUbg1iSggRTHU95ib_77bFMg/viewform",
        descricao: "üí¨ Formul√°rio de conversas dif√≠ceis"
      },
      {
        nome: "Formul√°rio de marketing/cartas de servi√ßos",
        link: "https://forms.gle/PjDSWbB3wxG6WX87A",
        descricao: "üì£ Formul√°rio de marketing/cartas de servi√ßos"
      },
      {
        nome: "Link para automatiza√ß√£o das atas",
        link: "https://docs.google.com/forms/d/e/1FAIpQLSej4zA2wQ1eBEicu2q8rP__kUC8UDCfoZ2KahxqmLmSDQ987Q/viewform",
        descricao: "üóÇÔ∏è Link para automatiza√ß√£o das atas"
      },
    ];

    // Fun√ß√£o para carregar formul√°rios tempor√°rios do localStorage
    function carregarFormulariosTemporarios() {
      const dados = localStorage.getItem('formulariosTemporarios');
      if (!dados) return [];
      try {
        const lista = JSON.parse(dados);
        // Filtrar s√≥ os que ainda n√£o expiraram
        const hoje = new Date();
        return lista.filter(f => new Date(f.validade) >= hoje);
      } catch {
        return [];
      }
    }

    // Salvar lista atualizada no localStorage
    function salvarFormulariosTemporarios(lista) {
      localStorage.setItem('formulariosTemporarios', JSON.stringify(lista));
    }

    // Fun√ß√£o para apagar formul√°rios expirados - usada no carregamento
    function limparFormulariosExpirados() {
      const lista = carregarFormulariosTemporarios();
      salvarFormulariosTemporarios(lista); // salva s√≥ os v√°lidos
    }

    // Estado da conversa para cadastro de formul√°rio tempor√°rio
    let estadoCadastro = null; 
    // objeto tempor√°rio para armazenar dados do novo formul√°rio
    let novoFormularioTemp = {};

    // Fun√ß√£o para listar formul√°rios v√°lidos (fixos + tempor√°rios)
    function listarFormulariosValidos() {
      const temporarios = carregarFormulariosTemporarios();
      const todos = [...formulariosFixos];
      // Adicionar tempor√°rios na lista final (com link e validade)
      temporarios.forEach(f => {
        todos.push({
          nome: f.nome,
          link: f.link,
          descricao: f.descricao + ` (Dispon√≠vel at√© ${f.validade})`
        });
      });
      return todos;
    }

    // Fun√ß√£o principal para responder mensagens
    function responder(texto) {
      texto = texto.toLowerCase().trim();

      // Se estamos no fluxo de cadastro de formul√°rio
      if (estadoCadastro) {
        if (estadoCadastro === 'nome') {
          if (texto.length < 3) {
            return 'ü§ñ Nome muito curto, por favor digite um nome v√°lido para o formul√°rio.';
          }
          novoFormularioTemp.nome = texto;
          estadoCadastro = 'link';
          return 'ü§ñ Agora digite o *link* do formul√°rio (come√ßando com http:// ou https://):';
        }
        if (estadoCadastro === 'link') {
          if (!texto.startsWith('http://') && !texto.startsWith('https://')) {
            return 'ü§ñ Link inv√°lido. Por favor, digite um link que comece com http:// ou https://';
          }
          novoFormularioTemp.link = texto;
          estadoCadastro = 'validade';
          return 'ü§ñ Por fim, digite a *data de validade* do formul√°rio no formato AAAA-MM-DD (ex: 2025-07-31):';
        }
        if (estadoCadastro === 'validade') {
          const data = new Date(texto);
          const hoje = new Date();
          if (isNaN(data.getTime())) {
            return 'ü§ñ Data inv√°lida. Por favor, digite no formato AAAA-MM-DD.';
          }
          if (data < hoje) {
            return 'ü§ñ Essa data j√° passou. Por favor, insira uma data futura.';
          }
          novoFormularioTemp.validade = texto;
          // Descri√ß√£o opcional: usar nome e link pra criar
          novoFormularioTemp.descricao = `Formul√°rio tempor√°rio: ${novoFormularioTemp.nome}`;
          // Salvar no localStorage
          const lista = carregarFormulariosTemporarios();
          lista.push(novoFormularioTemp);
          salvarFormulariosTemporarios(lista);
          estadoCadastro = null;
          novoFormularioTemp = {};
          return '‚úÖ Formul√°rio adicionado com sucesso e estar√° dispon√≠vel at√© a data informada!';
        }
      }

      // Comando especial para iniciar cadastro
      if (texto === 'adicionar formul√°rio' || texto === 'adicionar formulario') {
        estadoCadastro = 'nome';
        novoFormularioTemp = {};
        return 'ü§ñ Vamos cadastrar um novo formul√°rio tempor√°rio! Por favor, digite o *nome* do formul√°rio:';
      }

      // Consultas sobre formul√°rios tempor√°rios
      if (texto.includes('formul√°rio') || texto.includes('formulario') || texto.includes('form')) {
        const formularios = listarFormulariosValidos();
        if (formularios.length === 0) return 'ü§ñ Nenhum formul√°rio dispon√≠vel no momento.';
        let resposta = 'üìã *Formul√°rios dispon√≠veis:*\n';
        formularios.forEach((f, i) => {
          if (f.link) {
            resposta += `${i+1}. <strong>${f.nome}</strong>: <a href="${f.link}" target="_blank">${f.link}</a> - ${f.descricao}\n`;
          } else {
            resposta += `${i+1}. <strong>${f.nome}</strong>: ${f.descricao}\n`;
          }
        });
        return resposta;
      }

      // Outras respostas fixas (como antes)
      const respostas = [
        {
          pergunta: /voluntariado/i,
          resposta: 'üìÑ O termo ser√° enviado para seu e-mail via Autentique. Acesse sua conta pelo site: https://www.autentique.com.br/'
        },
        {
          pergunta: /presen√ßa|rg/i,
          resposta: 'üìÖ Link de presen√ßa nas RGs: https://forms.gle/s1KYUs62sUXyvSY88'
        },
        {
          pergunta: /justificativa/i,
          resposta: 'üìù Justificativa de aus√™ncia: https://forms.gle/LyPhkf5XfaFnhH3D9'
        },
        {
          pergunta: /desligamento/i,
          resposta: 'üö® Para solicitar o termo de desligamento, envie uma mensagem para a atual diretora de Gest√£o de Pessoas.'
        },
        {
          pergunta: /n√£o conformidade|nao conformidade/i,
          resposta: 'üìã Formul√°rio de n√£o conformidades: https://forms.gle/GFtWEwDWqGQhytcF9 üìò E-book: https://drive.google.com/file/d/14oAmosD0bzDpwmIo0jfMsQ6i_02c5Y_r/view?usp=drive_link'
        },
        {
          pergunta: /conversas dif√≠ceis|conversa/i,
          resposta: 'üí¨ Formul√°rio de conversas dif√≠ceis: https://docs.google.com/forms/d/e/1FAIpQLSdCFOsEcJzsIb5BOqX6KAJ-PNXUbg1iSggRTHU95ib_77bFMg/viewform'
        },
        {
          pergunta: /gamifica√ß√£o|gamificacao|pontos|ranking/i,
          resposta: `üèÜ *Gamifica√ß√£o Enpro Jr*

Na Enpro Jr, a gente acredita que dedica√ß√£o, engajamento e aprendizado merecem ser reconhecidos ‚Äî e √© a√≠ que entra a nossa Gamifica√ß√£o! üéÆ‚ú®

üéØ *O que gera pontos:*
- Participar de reuni√µes de √°rea e gerais
- Fazer cursos e capacita√ß√µes
- Preencher formul√°rios de feedback ou pesquisa
- Entregar atividades no prazo
- Se envolver em eventos da EJ ou do MEJ
- Demonstrar proatividade e colabora√ß√£o no dia a dia

üìà *Ranking e Reconhecimento:*
- Reconhecimento em reuni√µes
- Men√ß√µes em comunica√ß√µes internas
- Brindes e premia√ß√µes (quando rolarem üëÄ)
- MUITO orgulho de fazer parte do time!`
        },
        {
          pergunta: /pdi|avd/i,
          resposta: `üìö *PDI e AVD*

üìå *PDI* (Plano de Desenvolvimento Individual): ajuda a captar a inten√ß√£o do membro e os pontos que ele deseja desenvolver na EJ.
üìå *AVD* (Avalia√ß√£o de Desempenho): √© uma avalia√ß√£o 360¬∞, onde membros avaliam colegas e tamb√©m diretores.`
        },
        {
          pergunta: /hino/i,
          resposta: `üé∂ *Hino da Enpro Jr.*
O hino foi inspirado em uma torcida do Sport Club e adaptado para a Enpro, refor√ßando nossa cultura!

‚ñ∂Ô∏è Ou√ßa aqui: https://drive.google.com/file/d/1A5fIHPcvX1cPGZ-Op1NgSMHJ9m-u1e4K/view?usp=drive_link

üé§ Letra:
Dizem por a√≠ que a Enpro vai voar
Nesse palco vai subir, no evento vai pocar
A melhor do ES o MEJ consagrou
Quero ver tu encarar o jacar√© que √© o terror

OOOBA √ä√ä√ä√ä, lalaialaia
Vem pra ENPRO, vem voar
Lalaialaia
Nossa meta vai dobrar

Somos? Enpro
Bora? Voar
Bora? Voar!!!`
        },
        {
          pergunta: /estatuto/i,
          resposta: 'üìò Estatuto da EJ: https://drive.google.com/file/d/1tqxnb32rJ8bda_XD4P1URJeG8kzPQBj5/view?usp=drive_link'
        },
        {
          pergunta: /marketing|cartas de servi√ßos/i,
          resposta: 'üì£ Formul√°rio de marketing/cartas de servi√ßos: https://forms.gle/PjDSWbB3wxG6WX87A'
        },
        {
          pergunta: /atas|automatiza√ß√£o/i,
          resposta: 'üóÇÔ∏è Link para automatiza√ß√£o das atas: https://docs.google.com/forms/d/e/1FAIpQLSej4zA2wQ1eBEicu2q8rP__kUC8UDCfoZ2KahxqmLmSDQ987Q/viewform'
        },
        {
          pergunta: /formul√°rio em aberto|outro/i,
          resposta: 'üì® Caso haja outro formul√°rio ativo no momento, ele ser√° divulgado aqui. Se tiver d√∫vidas espec√≠ficas, fale com a equipe de Gest√£o de Pessoas!'
        }
      ];

      for (const item of respostas) {
        if (item.pergunta.test(texto)) {
          return item.resposta;
        }
      }

      // Sugest√£o de palavras parecidas
      const palavrasChave = [
        'voluntariado', 'presen√ßa', 'justificativa', 'desligamento',
        'n√£o conformidade', 'conversas dif√≠ceis', 'gamifica√ß√£o', 'pdi',
        'avd', 'hino', 'estatuto', 'marketing', 'atas', 'formul√°rio'
      ];

      for (const palavra of palavrasChave) {
        const similar = palavra.normalize("NFD").replace(/[\u0300-\u036f]/g, '');
        const entrada = texto.normalize("NFD").replace(/[\u0300-\u036f]/g, '');

        if (entrada.includes(similar.slice(0, 4))) {
          return `ü§ñ Voc√™ quis dizer *${palavra}*? Tente digitar novamente com mais detalhes!`;
        }
      }

      return '‚ùì Desculpe, n√£o entendi. Tente reformular sua pergunta ou fale com a equipe de GP.';
    }

    // Fun√ß√£o para adicionar mensagem na tela
    function appendMessage(text, sender) {
      const div = document.createElement('div');
      div.classList.add('message', sender);
      div.innerHTML = text
        .replace(/\n/g, '<br>')
        .replace(/\*([^*]+)\*/g, '<strong>$1</strong>')
        .replace(/(https?:\/\/[^\s]+)/g, '<a href="$1" target="_blank">$1</a>');

      chatbox.appendChild(div);
      chatbox.scrollTop = chatbox.scrollHeight;
    }

    // Limpar expirados ao carregar
    limparFormulariosExpirados();

    sendbtn.addEventListener('click', () => {
      const texto = input.value.trim();
      if (!texto) return;
      appendMessage('Voc√™: ' + texto, 'user');
      const resposta = responder(texto);
      setTimeout(() => {
        appendMessage('Jos√©: ' + resposta, 'bot');
      }, 500);
      input.value = '';
      input.focus();
    });

    input.addEventListener('keypress', e => {
      if (e.key === 'Enter') sendbtn.click();
    });

    appendMessage('Jos√©: Voc√™ deve estar surpreso em me ver aqui, n√©? üëÄ Mas n√£o sou s√≥ um mascote bonit√£o... tamb√©m trabalho! üíº Me pergunte algo sobre formul√°rios, gamifica√ß√£o, PDI, n√£o conformidades, estatuto... T√¥ aqui pra te ajudar! üêä‚ú®', 'bot');
  </script>

</body>
</html>
